{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState, useRef } from 'react';\nimport socketIOClient from 'socket.io-client'; //for heroku\n// const SOCKET_SERVER_URL = 'https://pomodoer.herokuapp.com/';\n//for local environ.\n\nconst SOCKET_SERVER_URL = 'http://localhost:5000';\nconst TIMER_START_STOP = 'timerPush';\nconst TIMER_WORK_REST = 'workRestPush';\nconst INFORMATION_TO_CLIENT = 'sendInfo';\nconst POPULATE_TIMER = 'populateTimer';\nvar clientData = {\n  start: false,\n  work: true,\n  minutes: 25,\n  seconds: 0,\n  alarmSound: false,\n  infoReceived: false,\n  action: false,\n  countdown: 0,\n  clock: 0,\n  display: 0\n};\nvar start = clientData.start;\nvar work = clientData.work;\nvar minutes = clientData.minutes;\nvar seconds = clientData.seconds;\nvar alarmSound = clientData.alarmSound;\nvar infoReceived = clientData.infoReceived;\nvar action = clientData.action;\nvar countdown = clientData.countdown;\nvar clock = clientData.clock;\nvar display = display;\n\nconst useTimer = roomId => {\n  _s();\n\n  // const [start, setStart] = useState(false);\n  // const [work, setWork] = useState(true);\n  // const [minutes, setMinutes] = useState(25);\n  // const [seconds, setSeconds] = useState(0);\n  const socketRef = useRef(); // const [alarmSound, setAlarmSound] = useState(false)\n  // const [infoReceived, setInfoReceived] = useState(false)\n  //initialize these after info pulled from server?\n  // const [action,setAction] = useState(false)\n  // const [countdown, setCountdown] = useState(1500000)\n  // const [clock, setClock] = useState(1614986917000)\n  // const [display, setDisplay] = useState(1500000)\n\n  useEffect(() => {\n    // creates websocket connection\n    socketRef.current = socketIOClient(SOCKET_SERVER_URL, {\n      query: {\n        roomId\n      }\n    }); // listens for timer start/stop push\n\n    socketRef.current.on(TIMER_START_STOP, data => {\n      start = !data.start;\n      console.log('start/stop received');\n    }); //listens for information on connection\n\n    if (infoReceived === false) {\n      socketRef.current.on(POPULATE_TIMER, data => {\n        action = data.action;\n        countdown = data.countdown;\n        display = data.countdown;\n        clock = data.clock;\n        action = data.action;\n        console.log('connection information received', data);\n        console.log('set with data', action, countdown, display, clock);\n        infoReceived = true;\n        console.log('setInfoReceived', infoReceived);\n      });\n    } //listens for information\n\n\n    socketRef.current.on(INFORMATION_TO_CLIENT, data => {\n      action = data.action;\n      countdown = data.countdown;\n      clock = data.clock;\n      start = data.action;\n      console.log('information received', data);\n    });\n    socketRef.current.on(TIMER_WORK_REST, data => {\n      work = !data.work;\n\n      if (work === true) {\n        minutes = 5;\n        seconds = 0;\n      } else {\n        minutes = 25;\n        seconds = 0;\n      }\n    }); // destroy socket reference when the connection is closed\n\n    return () => {\n      socketRef.current.disconnect();\n    };\n  }, [roomId]); //calculates display time in ms based on server data\n\n  const calculateTime = () => {\n    if (action === false) {\n      display = countdown;\n      console.log('setting display', display, countdown);\n    } else {\n      const difference = Date.now() - clock;\n      display = Math.max(0, countdown - difference);\n      console.log('difference', difference);\n      console.log('currentDate', Date.now());\n    }\n\n    console.log('inside caluclateTime', display);\n  };\n\n  const convert = () => {\n    minutes = Math.floor(display / 1000 / 60);\n    console.log('between setting minutes and seconds', display);\n    seconds = Math.floor(display / 1000 % 60);\n    console.log('inside conversion', display, minutes, seconds);\n\n    if (minutes === seconds === 0) {\n      alarmSound = true;\n      work = !work;\n      socketRef.current.emit(TIMER_WORK_REST, {\n        work: work\n      });\n      console.log('inside conditional in conversion');\n    } else {\n      alarmSound = false;\n    }\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      calculateTime();\n      convert();\n    }, 0);\n  }); //sends message to server that forwards to all users in room\n\n  const sendStart = start => {\n    socketRef.current.emit(TIMER_START_STOP, {\n      start: start,\n      countdown: display\n    });\n  };\n\n  const sendWork = work => {\n    socketRef.current.emit(TIMER_WORK_REST, {\n      work: work\n    });\n  };\n\n  return {\n    start,\n    sendStart,\n    work,\n    sendWork,\n    minutes,\n    seconds,\n    alarmSound,\n    infoReceived\n  };\n};\n\n_s(useTimer, \"sOoGPfr2IEyc8S7bWkmAqPt/gWk=\");\n\nexport default useTimer;","map":{"version":3,"sources":["/Users/bubird/Documents/GitHub/pomodoer/src/useTimer.js"],"names":["useEffect","useState","useRef","socketIOClient","SOCKET_SERVER_URL","TIMER_START_STOP","TIMER_WORK_REST","INFORMATION_TO_CLIENT","POPULATE_TIMER","clientData","start","work","minutes","seconds","alarmSound","infoReceived","action","countdown","clock","display","useTimer","roomId","socketRef","current","query","on","data","console","log","disconnect","calculateTime","difference","Date","now","Math","max","convert","floor","emit","setTimeout","sendStart","sendWork"],"mappings":"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","sourcesContent":["import {useEffect, useState, useRef} from 'react';\nimport socketIOClient from 'socket.io-client';\n\n\n//for heroku\n// const SOCKET_SERVER_URL = 'https://pomodoer.herokuapp.com/';\n\n//for local environ.\nconst SOCKET_SERVER_URL = 'http://localhost:5000';\n\n\n\nconst TIMER_START_STOP = 'timerPush';\nconst TIMER_WORK_REST = 'workRestPush';\nconst INFORMATION_TO_CLIENT = 'sendInfo';\nconst POPULATE_TIMER = 'populateTimer';\n\nvar clientData = {\n    start: false,\n    work: true,\n    minutes: 25,\n    seconds: 0,\n    alarmSound: false,\n    infoReceived: false,\n    action: false,\n    countdown: 0,\n    clock: 0,\n    display: 0,\n}\n\nvar start = clientData.start\nvar work = clientData.work\nvar minutes = clientData.minutes\nvar seconds = clientData.seconds\nvar alarmSound = clientData.alarmSound\nvar infoReceived = clientData.infoReceived\nvar action = clientData.action\nvar countdown = clientData.countdown\nvar clock = clientData.clock\nvar display = display \n\nconst useTimer = (roomId) => {\n    \n    // const [start, setStart] = useState(false);\n    // const [work, setWork] = useState(true);\n    // const [minutes, setMinutes] = useState(25);\n    // const [seconds, setSeconds] = useState(0);\n    const socketRef = useRef();\n    // const [alarmSound, setAlarmSound] = useState(false)\n    // const [infoReceived, setInfoReceived] = useState(false)\n\n    //initialize these after info pulled from server?\n\n    // const [action,setAction] = useState(false)\n    // const [countdown, setCountdown] = useState(1500000)\n    // const [clock, setClock] = useState(1614986917000)\n    // const [display, setDisplay] = useState(1500000)\n\n    useEffect(()=> {\n        // creates websocket connection\n        socketRef.current = socketIOClient(SOCKET_SERVER_URL, {\n            query:{roomId},\n        });\n        \n        // listens for timer start/stop push\n        socketRef.current.on(TIMER_START_STOP, (data) => {\n            start = !data.start;\n            console.log('start/stop received')\n        });\n\n        //listens for information on connection\n        if (infoReceived === false) {\n            socketRef.current.on(POPULATE_TIMER, (data) => {\n                action = data.action\n                countdown = data.countdown\n                display = data.countdown\n                clock = data.clock\n                action = data.action\n                console.log('connection information received', data)\n                console.log('set with data', action,countdown,display,clock)\n                infoReceived = true\n                console.log('setInfoReceived', infoReceived)\n            });\n        }\n\n        //listens for information\n        socketRef.current.on(INFORMATION_TO_CLIENT, (data) => {\n            action = data.action\n            countdown = data.countdown\n            clock = data.clock\n            start = data.action\n            console.log('information received', data)\n        });\n\n        socketRef.current.on(TIMER_WORK_REST, (data) => {\n            work = !data.work\n            if (work === true){\n                minutes = 5;\n                seconds = 0;\n              } else {\n                minutes = 25;\n                seconds = 0;\n              }\n    \n        })\n\n        // destroy socket reference when the connection is closed\n        return () => {\n            socketRef.current.disconnect();\n        };\n    }, [roomId]);\n\n    //calculates display time in ms based on server data\n    const calculateTime = () => {\n        if (action === false) {\n            display = countdown\n            console.log('setting display',display,countdown)\n        } else {\n            const difference = Date.now()-clock\n            display = Math.max(0,countdown-difference)\n            console.log('difference',difference)\n            console.log('currentDate',Date.now())\n        }\n        console.log('inside caluclateTime',display)\n    } \n\n    const convert = () => {\n        minutes = Math.floor(display/1000/60)\n        console.log('between setting minutes and seconds', display)\n        seconds = Math.floor ((display/1000) % 60)\n        console.log('inside conversion', display, minutes, seconds)\n        if (minutes === seconds === 0) {\n            alarmSound  = true\n            work = !work\n            socketRef.current.emit(TIMER_WORK_REST, {\n                work:work\n            })\n            console.log('inside conditional in conversion' )\n        } else {\n            alarmSound = false\n        }\n    }\n\n    useEffect(() => {\n        setTimeout(() => {\n            calculateTime();\n            convert();\n        }, 0);\n    })\n\n    //sends message to server that forwards to all users in room\n    const sendStart = (start) => {\n        socketRef.current.emit(TIMER_START_STOP, {\n            start: start,\n            countdown: display,\n        });\n    }\n\n    const sendWork = (work) => {\n        socketRef.current.emit(TIMER_WORK_REST, {\n            work: work,\n        })\n    }\n\n    return {start, sendStart, work, sendWork, minutes, seconds, alarmSound, infoReceived}\n}\n\nexport default useTimer\n\n"]},"metadata":{},"sourceType":"module"}