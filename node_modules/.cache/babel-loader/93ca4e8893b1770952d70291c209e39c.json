{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState, useRef } from 'react';\nimport socketIOClient from 'socket.io-client'; //for heroku\n// const SOCKET_SERVER_URL = 'https://pomodoer.herokuapp.com/';\n//for local environ.\n\nconst SOCKET_SERVER_URL = 'http://localhost:5000';\nconst TIMER_START_STOP = 'timerPush';\nconst TIMER_WORK_REST = 'workRestPush';\nconst INFORMATION_TO_CLIENT = 'sendInfo';\nconst POPULATE_TIMER = 'populateTimer'; // var clientData = {\n//     start: false,\n//     work: true,\n//     minutes: 25,\n//     seconds: 0,\n//     alarmSound: false,\n//     infoReceived: false,\n//     action: false,\n//     countdown: 0,\n//     clock: 0,\n//     display: 0,\n// }\n// var start = clientData.start\n// var work = clientData.work\n// var minutes = clientData.minutes\n// var seconds = clientData.seconds\n// var alarmSound = clientData.alarmSound\n// var infoReceived = clientData.infoReceived\n// var action = clientData.action\n// var countdown = clientData.countdown\n// var clock = clientData.clock\n// var display = display \n\nconst useTimer = roomId => {\n  _s();\n\n  const [start, setStart] = useState(false);\n  const [work, setWork] = useState(true);\n  const [minutes, setMinutes] = useState(25);\n  const [seconds, setSeconds] = useState(0);\n  const socketRef = useRef();\n  const [alarmSound, setAlarmSound] = useState(false);\n  const [infoReceived, setInfoReceived] = useState(false); //initialize these after info pulled from server?\n\n  const [countdown, setCountdown] = useState(1500000);\n  const [clock, setClock] = useState(1614986917000);\n  const [display, setDisplay] = useState(1500000);\n  useEffect(() => {\n    // creates websocket connection\n    console.log('setting up websocket cconnection ====');\n    socketRef.current = socketIOClient(SOCKET_SERVER_URL, {\n      query: {\n        roomId\n      }\n    }); // listens for timer start/stop push\n\n    socketRef.current.on(TIMER_START_STOP, data => {\n      setStart(data.start);\n      calculateTime();\n      convert();\n    }); //listens for information on connection\n\n    if (infoReceived === false) {\n      console.log('how is this ever hit?');\n      socketRef.current.on(POPULATE_TIMER, data => {\n        setCountdown(data.countdown);\n        setDisplay(data.countdown);\n        setClock(data.clock);\n        setStart(data.action);\n        console.log('connection information received', data);\n        console.log('set with data', countdown, display, clock);\n        setInfoReceived(true);\n        calculateTime();\n        convert();\n        console.log('setInfoReceived', infoReceived);\n      });\n    } //listens for information\n\n\n    socketRef.current.on(INFORMATION_TO_CLIENT, data => {\n      setCountdown(data.countdown);\n      setClock(data.clock);\n      setStart(data.action);\n      console.log('information received', data);\n    });\n    socketRef.current.on(TIMER_WORK_REST, data => {\n      setWork(data.work);\n\n      if (data.work) {\n        setDisplay(300000);\n        setCountdown(300000);\n      } else {\n        setDisplay(1500000);\n        setCountdown(1500000);\n      }\n\n      convert();\n    }); // destroy socket reference when the connection is closed\n\n    return () => {\n      socketRef.current.disconnect();\n    };\n  }, [roomId]); //calculates display time in ms based on server data\n\n  const calculateTime = () => {\n    if (infoReceived === true) {\n      if (start === false) {\n        setDisplay(countdown);\n        console.log('setting display', display, countdown);\n      } else {\n        const difference = Date.now() - clock;\n        setDisplay(Math.max(0, countdown - difference));\n        console.log('difference', difference);\n        console.log('currentDate', Date.now());\n      }\n\n      console.log('inside caluclateTime', display);\n    }\n  };\n\n  const convert = () => {\n    if (infoReceived === true) {\n      if (display === 0 && !alarmSound) {\n        setAlarmSound(true);\n        const newWork = !work;\n        sendWork(newWork);\n        console.log('inside conditional in conversion');\n      } else if (alarmSound) {\n        setAlarmSound(false);\n      }\n    }\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      calculateTime();\n      convert();\n    }, 1000);\n  }); //sends message to server that forwards to all users in room\n\n  const sendStart = start => {\n    const newStart = !start;\n    socketRef.current.emit(TIMER_START_STOP, {\n      start: newStart,\n      countdown: display\n    });\n    setStart(newStart);\n    convert();\n  };\n\n  const sendWork = work => {\n    const newWork = !work;\n    socketRef.current.emit(TIMER_WORK_REST, {\n      work: newWork\n    });\n    setWork(newWork);\n\n    if (!newWork) {\n      setDisplay(300000);\n      setCountdown(300000);\n    } else {\n      setDisplay(1500000);\n      setCountdown(1500000);\n    }\n\n    convert();\n  };\n\n  return {\n    start,\n    sendStart,\n    work,\n    sendWork,\n    display,\n    alarmSound,\n    infoReceived\n  };\n};\n\n_s(useTimer, \"yF/9bqoxH8UC2J5LOzvVbu8ffUU=\");\n\nexport default useTimer;","map":{"version":3,"sources":["/Users/bubird/Documents/GitHub/pomodoer/src/useTimer.js"],"names":["useEffect","useState","useRef","socketIOClient","SOCKET_SERVER_URL","TIMER_START_STOP","TIMER_WORK_REST","INFORMATION_TO_CLIENT","POPULATE_TIMER","useTimer","roomId","start","setStart","work","setWork","minutes","setMinutes","seconds","setSeconds","socketRef","alarmSound","setAlarmSound","infoReceived","setInfoReceived","countdown","setCountdown","clock","setClock","display","setDisplay","console","log","current","query","on","data","calculateTime","convert","action","disconnect","difference","Date","now","Math","max","newWork","sendWork","setTimeout","sendStart","newStart","emit"],"mappings":"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","sourcesContent":["import {useEffect, useState, useRef} from 'react';\nimport socketIOClient from 'socket.io-client';\n\n\n//for heroku\n// const SOCKET_SERVER_URL = 'https://pomodoer.herokuapp.com/';\n\n//for local environ.\nconst SOCKET_SERVER_URL = 'http://localhost:5000';\n\n\n\nconst TIMER_START_STOP = 'timerPush';\nconst TIMER_WORK_REST = 'workRestPush';\nconst INFORMATION_TO_CLIENT = 'sendInfo';\nconst POPULATE_TIMER = 'populateTimer';\n\n// var clientData = {\n//     start: false,\n//     work: true,\n//     minutes: 25,\n//     seconds: 0,\n//     alarmSound: false,\n//     infoReceived: false,\n//     action: false,\n//     countdown: 0,\n//     clock: 0,\n//     display: 0,\n// }\n\n// var start = clientData.start\n// var work = clientData.work\n// var minutes = clientData.minutes\n// var seconds = clientData.seconds\n// var alarmSound = clientData.alarmSound\n// var infoReceived = clientData.infoReceived\n// var action = clientData.action\n// var countdown = clientData.countdown\n// var clock = clientData.clock\n// var display = display \n\nconst useTimer = (roomId) => {\n    \n    const [start, setStart] = useState(false);\n    const [work, setWork] = useState(true);\n    const [minutes, setMinutes] = useState(25);\n    const [seconds, setSeconds] = useState(0);\n    const socketRef = useRef();\n    const [alarmSound, setAlarmSound] = useState(false)\n    const [infoReceived, setInfoReceived] = useState(false)\n\n    //initialize these after info pulled from server?\n\n    const [countdown, setCountdown] = useState(1500000)\n    const [clock, setClock] = useState(1614986917000)\n    const [display, setDisplay] = useState(1500000)\n\n    useEffect(()=> {\n        // creates websocket connection\n        console.log('setting up websocket cconnection ====')\n        socketRef.current = socketIOClient(SOCKET_SERVER_URL, {\n            query:{roomId},\n        });\n        \n        // listens for timer start/stop push\n        socketRef.current.on(TIMER_START_STOP, (data) => {\n            setStart(data.start);\n            calculateTime();\n            convert();\n        });\n\n        //listens for information on connection\n        if (infoReceived === false) {\n            console.log('how is this ever hit?')\n            socketRef.current.on(POPULATE_TIMER, (data) => {\n                setCountdown(data.countdown)\n                setDisplay(data.countdown)\n                setClock(data.clock)\n                setStart(data.action)\n                console.log('connection information received', data)\n                console.log('set with data',countdown,display,clock)\n                setInfoReceived(true)\n                calculateTime();\n                convert();\n                console.log('setInfoReceived', infoReceived)\n            });\n        }\n\n        //listens for information\n        socketRef.current.on(INFORMATION_TO_CLIENT, (data) => {\n            setCountdown(data.countdown)\n            setClock(data.clock)\n            setStart(data.action)\n            console.log('information received', data)\n        });\n\n        socketRef.current.on(TIMER_WORK_REST, (data) => {\n            setWork(data.work)\n            if (data.work) {\n                setDisplay(300000);\n                setCountdown(300000);\n              } else {\n                setDisplay(1500000);\n                setCountdown(1500000);\n              }\n              convert();\n        })\n\n        // destroy socket reference when the connection is closed\n        return () => {\n            socketRef.current.disconnect();\n        };\n    }, [roomId]);\n\n    //calculates display time in ms based on server data\n    const calculateTime = () => {\n        if (infoReceived === true) {\n            if (start === false) {\n                setDisplay(countdown)\n                console.log('setting display',display,countdown)\n            } else {\n                const difference = Date.now()-clock\n                setDisplay(Math.max(0,countdown-difference))\n                console.log('difference',difference)\n                console.log('currentDate',Date.now())\n            }\n            console.log('inside caluclateTime',display)\n        }\n    } \n\n    const convert = () => {\n        if (infoReceived === true) {\n            if (display === 0 && !alarmSound) {\n                setAlarmSound(true)\n                const newWork = !work;\n                sendWork(newWork);\n                console.log('inside conditional in conversion' )\n            } else if (alarmSound) {\n                setAlarmSound(false)\n            }\n        }\n    }\n\n    useEffect(() => {\n        setTimeout(() => {\n            calculateTime();\n            convert();\n        }, 1000);\n    })\n\n    //sends message to server that forwards to all users in room\n    const sendStart = (start) => {\n        const newStart = !start;\n        socketRef.current.emit(TIMER_START_STOP, {\n            start: newStart,\n            countdown: display,\n        });\n        setStart(newStart);\n        convert();\n    }\n\n    const sendWork = (work) => {\n        const newWork = !work\n        socketRef.current.emit(TIMER_WORK_REST, {\n            work: newWork,\n        })\n        setWork(newWork);\n        if (!newWork) {\n            setDisplay(300000);\n            setCountdown(300000)\n          } else {\n            setDisplay(1500000);\n            setCountdown(1500000);\n          }\n          convert();\n    }\n\n    return {start, sendStart, work, sendWork, display, alarmSound, infoReceived}\n}\n\nexport default useTimer\n\n"]},"metadata":{},"sourceType":"module"}