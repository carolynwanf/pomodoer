{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState, useRef } from 'react';\nimport socketIOClient from 'socket.io-client'; //for heroku\n// const SOCKET_SERVER_URL = 'https://pomodoer.herokuapp.com/';\n//for local environ.\n\nconst SOCKET_SERVER_URL = 'http://localhost:5000';\nconst TIMER_START_STOP = 'timerPush';\nconst TIMER_WORK_REST = 'workRestPush';\nconst INFORMATION_TO_CLIENT = 'sendInfo';\nconst POPULATE_TIMER = 'populateTimer'; // var clientData = {\n//     start: false,\n//     work: true,\n//     minutes: 25,\n//     seconds: 0,\n//     alarmSound: false,\n//     infoReceived: false,\n//     action: false,\n//     countdown: 0,\n//     clock: 0,\n//     display: 0,\n// }\n// var start = clientData.start\n// var work = clientData.work\n// var minutes = clientData.minutes\n// var seconds = clientData.seconds\n// var alarmSound = clientData.alarmSound\n// var infoReceived = clientData.infoReceived\n// var action = clientData.action\n// var countdown = clientData.countdown\n// var clock = clientData.clock\n// var display = display \n\nconst useTimer = roomId => {\n  _s();\n\n  const [start, setStart] = useState(false);\n  const [work, setWork] = useState(true);\n  const [minutes, setMinutes] = useState(25);\n  const [seconds, setSeconds] = useState(0);\n  const socketRef = useRef();\n  const [alarmSound, setAlarmSound] = useState(false);\n  const [infoReceived, setInfoReceived] = useState(false); //initialize these after info pulled from server?\n\n  const action = useRef(false);\n  const countdown = useRef(1500000);\n  const clock = useRef(Date.now());\n  const display = useRef(1500000);\n  useEffect(() => {\n    // creates websocket connection\n    socketRef.current = socketIOClient(SOCKET_SERVER_URL, {\n      query: {\n        roomId\n      }\n    }); // listens for timer start/stop push\n\n    socketRef.current.on(TIMER_START_STOP, data => {\n      setStart(!data.start);\n      console.log('start/stop received');\n    }); //listens for information on connection\n\n    if (infoReceived === false) {\n      socketRef.current.on(POPULATE_TIMER, data => {\n        action.current = data.action;\n        countdown.current = data.countdown;\n        display.current = data.countdown;\n        clock.current = data.clock;\n        setStart(data.action);\n        console.log('connection information received', data);\n        console.log('set with data', action.current, countdown.current, display.current, clock.current);\n        setInfoReceived(true);\n        console.log('setInfoReceived', infoReceived);\n      });\n    } //listens for information\n\n\n    socketRef.current.on(INFORMATION_TO_CLIENT, data => {\n      action.current = data.action;\n      countdown.current = data.countdown;\n      clock.current = data.clock;\n      setStart(data.action);\n      console.log('information received', data);\n    });\n    socketRef.current.on(TIMER_WORK_REST, data => {\n      const work = data.work;\n      setWork(!work);\n\n      if (work === true) {\n        setMinutes(5);\n        setSeconds(0);\n      } else {\n        setMinutes(25);\n        setSeconds(0);\n      }\n    }); // destroy socket reference when the connection is closed\n\n    return () => {\n      socketRef.current.disconnect();\n    };\n  }, [roomId]); //calculates display time in ms based on server data\n\n  const calculateTime = () => {\n    if (infoReceived === true) {\n      if (action.current === false) {\n        display.current = countdown.current;\n        console.log('setting display', display.current, countdown.current);\n      } else {\n        const difference = Date.now() - clock.current;\n        display.current = Math.max(0, countdown.current - difference);\n        console.log('difference', difference);\n        console.log('currentDate', Date.now());\n      }\n\n      console.log('inside caluclateTime', display.current);\n    }\n  };\n\n  const convert = () => {\n    if (infoReceived === true) {\n      setMinutes(Math.floor(display.current / 1000 / 60));\n      console.log('between setting minutes and seconds', display.current);\n      setSeconds(Math.floor(display.current / 1000 % 60));\n      console.log('inside conversion', display.current, minutes, seconds);\n\n      if (minutes === seconds === 0) {\n        setAlarmSound(true);\n        setWork(!work);\n        socketRef.current.emit(TIMER_WORK_REST, {\n          work: work\n        });\n        console.log('inside conditional in conversion');\n      } else {\n        setAlarmSound(false);\n      }\n    }\n  };\n\n  useEffect(() => {\n    setTimeout(() => {\n      calculateTime();\n      convert();\n    }, 0);\n  }); //sends message to server that forwards to all users in room\n\n  const sendStart = start => {\n    socketRef.current.emit(TIMER_START_STOP, {\n      start: start,\n      countdown: display.current\n    });\n  };\n\n  const sendWork = work => {\n    socketRef.current.emit(TIMER_WORK_REST, {\n      work: work\n    });\n  };\n\n  return {\n    start,\n    sendStart,\n    work,\n    sendWork,\n    minutes,\n    seconds,\n    alarmSound,\n    infoReceived\n  };\n};\n\n_s(useTimer, \"SLp4HrRASv49f/T4YHvnOWqVhVE=\");\n\nexport default useTimer;","map":{"version":3,"sources":["/Users/bubird/Documents/GitHub/pomodoer/src/useTimer.js"],"names":["useEffect","useState","useRef","socketIOClient","SOCKET_SERVER_URL","TIMER_START_STOP","TIMER_WORK_REST","INFORMATION_TO_CLIENT","POPULATE_TIMER","useTimer","roomId","start","setStart","work","setWork","minutes","setMinutes","seconds","setSeconds","socketRef","alarmSound","setAlarmSound","infoReceived","setInfoReceived","action","countdown","clock","Date","now","display","current","query","on","data","console","log","disconnect","calculateTime","difference","Math","max","convert","floor","emit","setTimeout","sendStart","sendWork"],"mappings":"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","sourcesContent":["import {useEffect, useState, useRef} from 'react';\nimport socketIOClient from 'socket.io-client';\n\n\n//for heroku\n// const SOCKET_SERVER_URL = 'https://pomodoer.herokuapp.com/';\n\n//for local environ.\nconst SOCKET_SERVER_URL = 'http://localhost:5000';\n\n\n\nconst TIMER_START_STOP = 'timerPush';\nconst TIMER_WORK_REST = 'workRestPush';\nconst INFORMATION_TO_CLIENT = 'sendInfo';\nconst POPULATE_TIMER = 'populateTimer';\n\n// var clientData = {\n//     start: false,\n//     work: true,\n//     minutes: 25,\n//     seconds: 0,\n//     alarmSound: false,\n//     infoReceived: false,\n//     action: false,\n//     countdown: 0,\n//     clock: 0,\n//     display: 0,\n// }\n\n// var start = clientData.start\n// var work = clientData.work\n// var minutes = clientData.minutes\n// var seconds = clientData.seconds\n// var alarmSound = clientData.alarmSound\n// var infoReceived = clientData.infoReceived\n// var action = clientData.action\n// var countdown = clientData.countdown\n// var clock = clientData.clock\n// var display = display \n\n\n\nconst useTimer = (roomId) => {\n    \n    const [start, setStart] = useState(false);\n    const [work, setWork] = useState(true);\n    const [minutes, setMinutes] = useState(25);\n    const [seconds, setSeconds] = useState(0);\n    const socketRef = useRef();\n    const [alarmSound, setAlarmSound] = useState(false);\n    const [infoReceived, setInfoReceived] = useState(false);\n\n    //initialize these after info pulled from server?\n\n    const action = useRef(false)\n    const countdown = useRef(1500000)\n    const clock = useRef(Date.now())\n    const display = useRef(1500000)\n\n\n    useEffect(()=> {\n        // creates websocket connection\n        socketRef.current = socketIOClient(SOCKET_SERVER_URL, {\n            query:{roomId},\n        });\n        \n        // listens for timer start/stop push\n        socketRef.current.on(TIMER_START_STOP, (data) => {\n            setStart(!data.start);\n            console.log('start/stop received')\n        });\n\n        //listens for information on connection\n        if (infoReceived === false) {\n            socketRef.current.on(POPULATE_TIMER, (data) => {\n                action.current = data.action\n                countdown.current = data.countdown\n                display.current = data.countdown\n                clock.current = data.clock\n                setStart(data.action)\n                console.log('connection information received', data)\n                console.log('set with data', action.current,countdown.current,display.current,clock.current)\n                setInfoReceived(true)\n                console.log('setInfoReceived', infoReceived)\n            });\n        }\n\n        //listens for information\n        socketRef.current.on(INFORMATION_TO_CLIENT, (data) => {\n            action.current = data.action\n            countdown.current = data.countdown\n            clock.current = data.clock\n            setStart(data.action)\n            console.log('information received', data)\n        });\n\n        socketRef.current.on(TIMER_WORK_REST, (data) => {\n            const work = data.work\n            setWork(!work)\n            if (work === true){\n                setMinutes(5);\n                setSeconds(0);\n              } else {\n                setMinutes(25);\n                setSeconds(0);\n              }\n    \n        })\n\n        // destroy socket reference when the connection is closed\n        return () => {\n            socketRef.current.disconnect();\n        };\n    }, [roomId]);\n\n    //calculates display time in ms based on server data\n    const calculateTime = () => {\n        if (infoReceived === true) {\n            if (action.current === false) {\n                display.current = countdown.current\n                console.log('setting display',display.current,countdown.current)\n            } else {\n                const difference = Date.now()-clock.current\n                display.current = Math.max(0,countdown.current-difference)\n                console.log('difference',difference)\n                console.log('currentDate',Date.now())\n            }\n            console.log('inside caluclateTime',display.current)\n        }\n    } \n\n    const convert = () => {\n        if (infoReceived === true) {\n            setMinutes(Math.floor(display.current/1000/60))\n            console.log('between setting minutes and seconds', display.current)\n            setSeconds(Math.floor ((display.current/1000) % 60))\n            console.log('inside conversion', display.current, minutes, seconds)\n            if (minutes === seconds === 0) {\n                setAlarmSound(true)\n                setWork(!work)\n                socketRef.current.emit(TIMER_WORK_REST, {\n                    work:work\n                })\n                console.log('inside conditional in conversion' )\n            } else {\n                setAlarmSound(false)\n            }\n        }\n    }\n\n    useEffect(() => {\n        setTimeout(() => {\n            calculateTime();\n            convert();\n        }, 0);\n    })\n\n    //sends message to server that forwards to all users in room\n    const sendStart = (start) => {\n        socketRef.current.emit(TIMER_START_STOP, {\n            start: start,\n            countdown: display.current,\n        });\n    }\n\n    const sendWork = (work) => {\n        socketRef.current.emit(TIMER_WORK_REST, {\n            work: work,\n        })\n    }\n\n    return {start, sendStart, work, sendWork, minutes, seconds, alarmSound, infoReceived}\n}\n\nexport default useTimer\n\n"]},"metadata":{},"sourceType":"module"}